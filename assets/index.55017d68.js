var B=Object.defineProperty;var V=(t,e,n)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>(V(t,typeof e!="symbol"?e+"":e,n),n),E=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var b=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)};var C=(t,e,n)=>(E(t,e,"access private method"),n);import{j as G,r as i,p as A,R as $,a as D}from"./vendor.238809fc.js";const F=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerpolicy&&(o.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?o.credentials="include":r.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}};F();const l=G.exports.jsx,O=G.exports.jsxs,y=i.exports.createContext([0,()=>{}]);function K({children:t}){const e=i.exports.useState(1);return l(y.Provider,{value:e,children:t})}const U=[1,2,3,4,5,6,7,8,9];function _(){const[t,e]=i.exports.useContext(y);return O("div",{className:"NumberPicker",children:[l("div",{style:{"--selected":t},className:"--Selection","data-testid":"number-picker-selection"}),l("ul",{className:"--Values",children:U.map(n=>l("li",{onClick:()=>e(n),style:{"--value":n},children:n},n))})]})}function q(t){return Math.floor(t/9)*9}function N(t){return Math.floor(q(t)/9)}function z(t){const e=Math.floor(t/9)*9;return Array.from({length:9}).map((n,s)=>e+s)}function T(t){return t%9}function S(t){return T(t)}function H(t){const e=t%9;return Array.from({length:9}).map((n,s)=>e+s*9)}function R(t){return Math.floor(t/27)*27+t%9-t%3}function w(t){const e=R(t);return e<9?Math.floor(e/3):e<36?Math.floor(3+(e-27)/3):Math.floor(6+(e-54)/3)}function J(t){const e=R(t);return[e,e+1,e+2,e+9,e+10,e+11,e+18,e+19,e+20]}function h(t,e,n){return Array.from({length:t}).reduce((s,r,o)=>{const c=e+o;return s[c]=n(c),s},{})}var p,M,x,I;class P{constructor(){b(this,p);b(this,x);m(this,"contents");m(this,"contentsCount");m(this,"rowOccurrences");m(this,"columnOccurrences");m(this,"blockOccurrences");m(this,"excessOccurrences");this.contents=h(81,0,()=>null),this.contentsCount=0,this.excessOccurrences=0,this.rowOccurrences=h(9,0,()=>h(9,1,()=>0)),this.columnOccurrences=h(9,0,()=>h(9,1,()=>0)),this.blockOccurrences=h(9,0,()=>h(9,1,()=>0))}isEmpty(){return this.contentsCount===0}isValid(){return this.excessOccurrences===0}isComplete(){return this.contentsCount==81&&this.isValid()}isValidCandidate(e,n){const s=N(e),r=S(e),o=w(e);return Math.max(this.rowOccurrences[s][n],this.columnOccurrences[r][n],this.blockOccurrences[o][n])===0}isValidContents(e){const n=this.contents[e];if(n===null)return!0;const s=N(e),r=S(e),o=w(e);return Math.max(this.rowOccurrences[s][n],this.columnOccurrences[r][n],this.blockOccurrences[o][n])===1}setContents(e,n){const s=this.contents[e];this.contents[e]=n;const r=N(e),o=S(e),c=w(e);s!==null?(C(this,x,I).call(this,this.rowOccurrences[r],s),C(this,x,I).call(this,this.columnOccurrences[o],s),C(this,x,I).call(this,this.blockOccurrences[c],s)):this.contentsCount++,n!==null?(C(this,p,M).call(this,this.rowOccurrences[r],n),C(this,p,M).call(this,this.columnOccurrences[o],n),C(this,p,M).call(this,this.blockOccurrences[c],n)):this.contentsCount--;const u=z(e),a=H(e),g=J(e),f=new Set(u.concat(a).concat(g));return Array.from(f)}}p=new WeakSet,M=function(e,n){e[n]++,e[n]>1&&this.excessOccurrences++},x=new WeakSet,I=function(e,n){e[n]--,e[n]>0&&this.excessOccurrences--};var d;(function(t){t[t.InvalidGrid=0]="InvalidGrid",t[t.CanStart=1]="CanStart",t[t.Started=2]="Started",t[t.Complete=3]="Complete"})(d||(d={}));const k=i.exports.createContext({status:0,rules:new P,startGame:()=>{},notifyContentsChange:()=>{}});function Q({children:t,rulesFactory:e}){const[n,s]=i.exports.useReducer((u,a)=>a===2&&u===1?a:(a===0||a===1)&&u===2?u:a,0),r=i.exports.useMemo(()=>e(),[]),o=i.exports.useCallback(()=>{r.isEmpty()?s(0):r.isComplete()?s(3):r.isValid()?s(1):s(0)},[]),c=i.exports.useCallback(()=>{s(2)},[]);return l(k.Provider,{value:{status:n,rules:r,startGame:c,notifyContentsChange:o},children:t})}const L=i.exports.createContext([j(),()=>{}]);function W(){return{contents:null,candidates:{1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null},isLocked:!1}}function j(){return Array.from({length:81}).map(W)}function X(t,e,n){return A(e,s=>{var o;if(n.action==="lockContents"){for(const c of s)c.contents!==null&&(c.isLocked=!0);return}const r=s[n.cell];n.action==="toggleContents"?(r.contents=((o=r.contents)==null?void 0:o[0])===n.contents?null:[n.contents,!0],t.setContents(n.cell,r.contents?r.contents[0]:null).forEach(u=>{const a=s[u].contents;a!==null&&(a[1]=t.isValidContents(u));for(const g in s[u].candidates){const f=parseInt(g);s[u].candidates[f]!==null&&(s[u].candidates[f]=t.isValidCandidate(u,f))}})):n.action==="toggleCandidate"&&(r.candidates[n.candidate]=r.candidates[n.candidate]===null?t.isValidCandidate(n.cell,n.candidate):null)})}function Y({children:t}){const{rules:e,status:n,notifyContentsChange:s}=i.exports.useContext(k),r=i.exports.useReducer((o,c)=>X(e,o,c),j());return i.exports.useEffect(()=>{n===d.Started&&r[1]({action:"lockContents"})},[n]),i.exports.useEffect(()=>{s()},[r[0]]),l(L.Provider,{value:r,children:t})}function Z({cell:t,i:e,dispatch:n,contextInfo:s}){function r(){n({action:"toggleContents",cell:e,contents:s.current.selectedNumber})}function o(){n({action:"toggleCandidate",cell:e,candidate:s.current.selectedNumber})}function c(){t.isLocked||(s.current.status===d.Started?o():s.current.status!==d.Complete&&r())}function u(){!t.isLocked&&s.current.status===d.Started&&r()}const[a,g]=t.contents===null?[null,!0]:t.contents;return O("div",{className:`--Cell ${t.isLocked?"-Locked":""} ${a?`-ShowingContents ${g?"-Valid":"-Invalid"}`:"-ShowingCandidates"}`,onClick:c,onDoubleClick:u,children:[l("div",{className:"--Candidates",children:Object.entries(t.candidates).map(([f,v])=>l("div",{className:`--Candidate ${v!==null?v?"-Valid":"-Invalid":""}`,children:v!==null?f:" "},f))}),l("div",{className:"--Contents",children:a})]})}const ee=i.exports.memo(Z);function te(){const[t,e]=i.exports.useContext(L),[n]=i.exports.useContext(y),{status:s}=i.exports.useContext(k),r=i.exports.useRef({selectedNumber:n,status:s});return r.current={selectedNumber:n,status:s},l("div",{className:"SudokuGrid","data-testid":"sudoku-grid",children:t.map((o,c)=>l(ee,{cell:o,i:c,dispatch:e,contextInfo:r},c))})}function ne(){const{status:t,startGame:e}=i.exports.useContext(k),n=t===d.InvalidGrid||t===d.CanStart;return l("div",{className:"ButtonBar",children:n&&l("button",{disabled:t===d.InvalidGrid,onClick:e,children:"Start"})})}function re(){return l("div",{className:"SudokuReact",children:l(Q,{rulesFactory:()=>new P,children:O(K,{children:[l(Y,{children:l(te,{})}),l(_,{}),l(ne,{})]})})})}$.render(l(D.StrictMode,{children:l(re,{})}),document.getElementById("root"));
